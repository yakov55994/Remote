<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>שלט מזגן חכם - זיהוי דגמים</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Heebo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%);
            min-height: 100vh;
            padding: 15px;
            direction: rtl;
            position: relative;
            overflow-x: hidden;
        }
        
        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .shape {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 8s ease-in-out infinite;
        }
        
        .shape:nth-child(1) {
            width: 100px;
            height: 100px;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }
        
        .shape:nth-child(2) {
            width: 150px;
            height: 150px;
            top: 50%;
            right: 10%;
            animation-delay: 3s;
        }
        
        .shape:nth-child(3) {
            width: 80px;
            height: 80px;
            top: 80%;
            left: 60%;
            animation-delay: 6s;
        }
        
        @keyframes float {
            0%, 100% { 
                transform: translateY(0px) rotate(0deg);
                opacity: 0.7;
            }
            50% { 
                transform: translateY(-20px) rotate(180deg);
                opacity: 0.9;
            }
        }
        
        .container {
            max-width: 440px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            color: white;
        }
        
        .main-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-size: 16px;
            opacity: 0.95;
            font-weight: 400;
        }
        
        .main-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(25px);
            border-radius: 28px;
            padding: 25px;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .main-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #667eea);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .setup-wizard {
            background: linear-gradient(135deg, #fff3e0, #ffecb3);
            border: 2px solid #ff9800;
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 25px;
            position: relative;
        }
        
        .wizard-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .wizard-title {
            font-size: 18px;
            font-weight: 700;
            color: #e65100;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .wizard-step {
            background: #ff9800;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .wizard-content {
            font-size: 14px;
            color: #333;
            line-height: 1.6;
        }
        
        .wizard-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .wizard-btn {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }
        
        .wizard-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
        }
        
        .wizard-btn.secondary {
            background: linear-gradient(135deg, #757575, #616161);
        }
        
        .learning-panel {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border: 2px solid #2196F3;
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 25px;
            display: none;
        }
        
        .learning-header {
            font-size: 18px;
            font-weight: 700;
            color: #1976D2;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .learning-steps {
            font-size: 14px;
            color: #333;
            line-height: 1.6;
        }
        
        .learning-steps ol {
            margin-right: 20px;
        }
        
        .learning-steps li {
            margin-bottom: 8px;
        }
        
        .ir-receiver {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            text-align: center;
            border: 2px solid #333;
        }
        
        .learn-btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }
        
        .learn-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
        }
        
        .learn-btn.learning {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .device-info {
            background: linear-gradient(135deg, #e8f5e8, #f0f8f0);
            border: 2px solid #4CAF50;
            border-radius: 18px;
            padding: 18px;
            margin-bottom: 25px;
        }
        
        .device-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .device-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .device-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4CAF50;
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.2);
            animation: pulse 2s infinite;
        }
        
        .device-text {
            font-weight: 600;
            color: #2e7d2e;
            font-size: 14px;
        }
        
        .device-details {
            font-size: 13px;
            color: #555;
            line-height: 1.4;
        }
        
        .detected-model {
            background: rgba(76, 175, 80, 0.1);
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 8px;
        }
        
        .brand-selector {
            margin-bottom: 25px;
        }
        
        .selector-label {
            display: block;
            font-size: 15px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .brand-select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e1e8ed;
            border-radius: 16px;
            font-size: 16px;
            font-family: 'Heebo', sans-serif;
            font-weight: 500;
            background: white;
            direction: rtl;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: left 15px center;
            background-repeat: no-repeat;
            background-size: 16px;
        }
        
        .model-selector {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e1e8ed;
            border-radius: 16px;
            font-size: 16px;
            font-family: 'Heebo', sans-serif;
            font-weight: 500;
            background: white;
            direction: rtl;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: left 15px center;
            background-repeat: no-repeat;
            background-size: 16px;
            margin-top: 10px;
        }
        
        .main-display {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #00d4ff;
            padding: 30px 25px;
            border-radius: 22px;
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .power-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e74c3c;
            transition: all 0.3s ease;
        }
        
        .power-indicator.on {
            background: #2ecc71;
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.8);
        }
        
        .temp-display {
            font-size: 52px;
            font-weight: 700;
            margin-bottom: 12px;
            text-shadow: 0 0 25px rgba(0, 212, 255, 0.6);
            transition: all 0.3s ease;
        }
        
        .mode-display {
            font-size: 20px;
            margin-bottom: 8px;
            opacity: 0.9;
        }
        
        .details-display {
            font-size: 14px;
            opacity: 0.7;
            line-height: 1.5;
        }
        
        .power-section {
            margin-bottom: 25px;
        }
        
        .power-button {
            width: 100%;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: none;
            padding: 22px;
            border-radius: 22px;
            font-size: 22px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .power-button:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 40px rgba(255, 107, 107, 0.4);
        }
        
        .power-button.active {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            box-shadow: 0 10px 30px rgba(46, 204, 113, 0.3);
        }
        
        .controls-section {
            display: grid;
            gap: 20px;
        }
        
        .control-group {
            background: rgba(248, 250, 252, 0.9);
            border-radius: 20px;
            padding: 22px;
            border: 1px solid rgba(226, 232, 240, 0.8);
        }
        
        .group-title {
            font-size: 17px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .temp-controls {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 15px;
            align-items: center;
        }
        
        .temp-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 16px;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }
        
        .temp-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .temp-mini-display {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 16px 22px;
            border-radius: 16px;
            text-align: center;
            font-size: 22px;
            font-weight: 700;
            min-width: 90px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }
        
        .modes-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .control-btn {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid #e2e8f0;
            color: #64748b;
            padding: 16px 12px;
            border-radius: 14px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-align: center;
            min-height: 50px;
        }
        
        .control-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }
        
        .control-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            font-weight: 500;
            z-index: 1000;
            transition: all 0.3s ease;
            border-left: 4px solid #4CAF50;
        }
        
        .notification.error {
            border-left-color: #f44336;
        }
        
        .notification.warning {
            border-left-color: #ff9800;
        }
        
        .brand-info-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 18px;
            border-radius: 18px;
            text-align: center;
            margin-top: 25px;
        }
        
        .brand-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 6px;
        }
        
        .brand-description {
            font-size: 13px;
            opacity: 0.9;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1 class="main-title">🎯 שלט מזגן חכם</h1>
            <p class="subtitle">זיהוי אוטומטי של הדגם שלך</p>
        </div>
        
        <div class="main-card">
            <!-- אשף הגדרה ראשונית -->
            <div class="setup-wizard" id="setupWizard">
                <div class="wizard-header">
                    <div class="wizard-title">
                        🔍 גילוי המזגן שלך
                    </div>
                    <div class="wizard-step" id="wizardStep">שלב 1/3</div>
                </div>
                <div class="wizard-content" id="wizardContent">
                    <strong>ברוכים הבאים!</strong><br>
                    האפליקציה תזהה את המזגן שלך באופן אוטומטי בשלושה שלבים קלים.
                    <br><br>
                    <strong>שלב 1:</strong> בחירת מותג המזגן<br>
                    <strong>שלב 2:</strong> למידת קודי השלט שלך<br>
                    <strong>שלב 3:</strong> בדיקה וקליברציה
                </div>
                <div class="wizard-buttons">
                    <button class="wizard-btn" onclick="startWizard()">התחל גילוי 🚀</button>
                    <button class="wizard-btn secondary" onclick="skipWizard()">דלג</button>
                </div>
            </div>
            
            <!-- פאנל למידה -->
            <div class="learning-panel" id="learningPanel">
                <div class="learning-header">
                    🤖 למידת המזגן שלך
                </div>
                <div class="learning-steps">
                    <p><strong>המערכת תלמד את הקודים של השלט שלך:</strong></p>
                    <ol>
                        <li>הכוון את השלט המקורי לעבר המכשיר</li>
                        <li>לחץ על הכפתור "התחל למידה"</li>
                        <li>כשיופיע "מוכן לקליטה", לחץ על כפתור ההפעלה בשלט</li>
                        <li>חזור על התהליך לכל הכפתורים</li>
                    </ol>
                    
                    <div class="ir-receiver" id="irReceiver">
                        IR Receiver: מחכה לאות...
                    </div>
                    
                    <button class="learn-btn" id="learnBtn" onclick="startLearning()">
                        התחל למידה 📡
                    </button>
                </div>
            </div>
            
            <!-- מידע על המכשיר שזוהה -->
            <div class="device-info" id="deviceInfo" style="display: none;">
                <div class="device-header">
                    <div class="device-status">
                        <div class="device-icon"></div>
                        <span class="device-text">מזגן זוהה בהצלחה!</span>
                    </div>
                </div>
                <div class="device-details">
                    <div class="detected-model" id="detectedModel">
                        אלקטרה Elite Pro 18 - דגם ELT-18H
                    </div>
                    <div style="margin-top: 8px;">
                        הקודים נלמדו בהצלחה • 12 פקודות זמינות
                    </div>
                </div>
            </div>
            
            <!-- בחירת מותג ודגם ידנית -->
            <div class="brand-selector">
                <label class="selector-label">בחר מותג המזגן:</label>
                <select class="brand-select" id="brandSelect">
                    <option value="">🔍 גילוי אוטומטי...</option>
                    <option value="electra">🏠 אלקטרה (Electra)</option>
                    <option value="tadiran">⚡ טדיראן (Tadiran)</option>
                    <option value="amcor">🌟 אמקור (Amcor)</option>
                    <option value="mitsubishi">🇯🇵 מיצובישי (Mitsubishi)</option>
                    <option value="daikin">🌍 דייקין (Daikin)</option>
                    <option value="lg">📱 LG</option>
                    <option value="samsung">💫 סמסונג (Samsung)</option>
                    <option value="carrier">❄️ קרייר (Carrier)</option>
                    <option value="york">🏢 יורק (York)</option>
                    <option value="gree">🌿 גרי (Gree)</option>
                    <option value="haier">🔧 האייר (Haier)</option>
                    <option value="sharp">⚡ שארפ (Sharp)</option>
                </select>
                
                <select class="model-selector" id="modelSelect" style="display: none;">
                    <option value="">בחר דגם...</option>
                </select>
            </div>
            
            <div class="main-display" id="mainDisplay">
                <div class="power-indicator" id="powerIndicator"></div>
                <div class="temp-display" id="tempDisplay">--°</div>
                <div class="mode-display" id="modeDisplay">בחר מזגן תחילה</div>
                <div class="details-display" id="detailsDisplay">השתמש באשף הגילוי למעלה</div>
            </div>
            
            <div class="power-section">
                <button class="power-button" id="powerButton" onclick="togglePower()" disabled>
                    <span>🔌 הפעלה / כיבוי</span>
                </button>
            </div>
            
            <div class="controls-section">
                <div class="control-group">
                    <div class="group-title">
                        🌡️ בקרת טמפרטורה
                    </div>
                    <div class="temp-controls">
                        <button class="temp-btn" onclick="adjustTemp(-1)" disabled>➖</button>
                        <div class="temp-mini-display" id="tempMiniDisplay">--°</div>
                        <button class="temp-btn" onclick="adjustTemp(1)" disabled>➕</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="group-title">
                        🔄 מצב פעולה
                    </div>
                    <div class="modes-grid">
                        <button class="control-btn" onclick="setMode('cool')" data-mode="cool" disabled>
                            ❄️ קירור
                        </button>
                        <button class="control-btn" onclick="setMode('heat')" data-mode="heat" disabled>
                            🔥 חימום
                        </button>
                        <button class="control-btn" onclick="setMode('dry')" data-mode="dry" disabled>
                            💨 יבוש
                        </button>
                        <button class="control-btn" onclick="setMode('fan')" data-mode="fan" disabled>
                            🌪️ מאוורר
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="brand-info-card">
                <div class="brand-title" id="brandTitle">🔍 זיהוי מזגן</div>
                <div class="brand-description" id="brandDescription">השתמש באשף הגילוי כדי לזהות את המזגן שלך אוטומטית</div>
            </div>
        </div>
    </div>

    <script>
        // מצב המזגן
        let acState = {
            power: false,
            temperature: 22,
            mode: 'cool',
            fanSpeed: 'auto',
            brand: '',
            model: '',
            learned: false,
            learnedCodes: {},
            wizardStep: 1
        };

        // דגמים של כל מותג (דוגמאות אמיתיות)
        const brandModels = {
            electra: [
                'Elite Pro 12 (ELT-12H)',
                'Elite Pro 18 (ELT-18H)',
                'Elite Pro 24 (ELT-24H)',
                'Digital Inverter 12 (DIG-12)',
                'Digital Inverter 18 (DIG-18)',
                'Classic 12 (CLS-12)',
                'Classic 18 (CLS-18)',
                'Premium 12 (PRM-12)',
                'Premium 18 (PRM-18)',
                'Wind 12 (WND-12)'
            ],
            tadiran: [
                'Wind Inverter 12 (WI-12)',
                'Wind Inverter 18 (WI-18)',
                'Supreme 12 (SUP-12)',
                'Supreme 18 (SUP-18)',
                'Alpha Inverter 12 (ALF-12)',
                'Alpha Inverter 18 (ALF-18)',
                'Vogue 12 (VOG-12)',
                'Vogue 18 (VOG-18)',
                'Spirit 12 (SPI-12)',
                'Silence Pro 18 (SIL-18)'
            ],
            daikin: [
                'Sensira FTXC25B (12,000 BTU)',
                'Sensira FTXC35B (18,000 BTU)',
                'Emura FTXJ25MS (12,000 BTU)',
                'Emura FTXJ35MS (18,000 BTU)',
                'Perfera FTXM25M (12,000 BTU)',
                'Perfera FTXM35M (18,000 BTU)',
                'Comfora FTXP25M (12,000 BTU)',
                'Comfora FTXP35M (18,000 BTU)'
            ],
            lg: [
                'Art Cool Gallery 12 (A12FR)',
                'Art Cool Gallery 18 (A18FR)',
                'Standard Plus 12 (S12EQ)',
                'Standard Plus 18 (S18EQ)',
                'Deluxe 12 (D12RN)',
                'Deluxe 18 (D18RN)',
                'Mega Inverter 12 (M12AH)',
                'Mega Inverter 18 (M18AH)'
            ],
            samsung: [
                'Wind-Free Elite 12 (AR12)',
                'Wind-Free Elite 18 (AR18)',
                'Digital Inverter 12 (DV12)',
                'Digital Inverter 18 (DV18)',
                'Triangle Design 12 (TR12)',
                'Triangle Design 18 (TR18)',
                'Maldives 12 (ML12)',
                'Maldives 18 (ML18)'
            ],
            mitsubishi: [
                'MSZ-AP25VG (12,000 BTU)',
                'MSZ-AP35VG (18,000 BTU)',
                'MSZ-HR25VF (12,000 BTU)',
                'MSZ-HR35VF (18,000 BTU)',
                'MSZ-EF25VE (12,000 BTU)',
                'MSZ-EF35VE (18,000 BTU)'
            ]
        };

        // מידע על מותגים
        const brandInfo = {
            electra: { name: 'אלקטרה', info: 'מזגנים איכותיים לבית הישראלי' },
            tadiran: { name: 'טדיראן', info: 'טכנולוגיה מתקדמת וחסכון באנרגיה' },
            amcor: { name: 'אמקור', info: 'פתרונות מיזוג מקצועיים' },
            mitsubishi: { name: 'מיצובישי', info: 'טכנולוגיה יפנית מתקדמת' },
            daikin: { name: 'דייקין', info: 'מובילה עולמית במזגנים' },
            lg: { name: 'LG', info: 'חדשנות קוריאנית בעיצוב מודרני' },
            samsung: { name: 'סמסונג', info: 'טכנולוגיה חכמה ויעילות אנרגטית' }
        };

        // קודי IR לדוגמא (בפועל יילמדו מהשלט)
        const sampleIRCodes = {
            electra: {
                'Elite Pro 18 (ELT-18H)': {
                    power: 'JgBYAAABJJURExQTFBIUEhQSFBIUEhQTFBIUExQSFBMUEhQTFBIUExQSFBMUEhQTFBIUExQTFBIUEhQTFRIUEhQTFBIUEhQADQUAAA==',
                    cool_22: 'JgBgAAABJJURExQTFBIUEhQSFBIUEhQTFBIUExQSFBMUEhQTFBIUExQSFBMUEhQTFBIUExQTFBIUEhQTFRIUEhQTFBIUEhQTFBIUEhQTFBIUExQSFBMUEhQTFBIADQU='
                }
            }
        };

        // אשף הגדרה
        function startWizard() {
            acState.wizardStep = 2;
            document.getElementById('setupWizard').style.display = 'none';
            document.getElementById('learningPanel').style.display = 'block';
            showNotification('🚀 מתחיל תהליך הגילוי', 'success');
        }

        function skipWizard() {
            document.getElementById('setupWizard').style.display = 'none';
            showNotification('ℹ️ דילגת על הגילוי - בחר מותג ידנית', 'warning');
        }

        // למידת קודי IR
        let learningInProgress = false;
        let currentLearningCommand = '';

        async function startLearning() {
            if (learningInProgress) {
                stopLearning();
                return;
            }

            learningInProgress = true;
            const learnBtn = document.getElementById('learnBtn');
            const irReceiver = document.getElementById('irReceiver');
            
            learnBtn.textContent = 'עצור למידה 🛑';
            learnBtn.classList.add('learning');
            
            // רשימת הפקודות ללמידה
            const commandsToLearn = ['power', 'cool_22', 'heat_22', 'cool_18', 'heat_18', 'fan', 'dry'];
            
            for (let i = 0; i < commandsToLearn.length && learningInProgress; i++) {
                currentLearningCommand = commandsToLearn[i];
                
                irReceiver.textContent = `מוכן לקליטה: ${getCommandDescription(currentLearningCommand)}`;
                irReceiver.style.background = '#1a4d1a';
                irReceiver.style.color = '#00ff00';
                
                // המתנה לאות IR (סימולציה)
                await waitForIRSignal();
                
                if (learningInProgress) {
                    // הצגת האות שנתקבל
                    const receivedCode = generateRandomIRCode();
                    acState.learnedCodes[currentLearningCommand] = receivedCode;
                    
                    irReceiver.textContent = `✅ נתקבל: ${currentLearningCommand}`;
                    irReceiver.style.background = '#1a4d1a';
                    irReceiver.style.color = '#00ff88';
                    
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            if (learningInProgress) {
                finishLearning();
            }
        }

        function stopLearning() {
            learningInProgress = false;
            const learnBtn = document.getElementById('learnBtn');
            const irReceiver = document.getElementById('irReceiver');
            
            learnBtn.textContent = 'התחל למידה 📡';
            learnBtn.classList.remove('learning');
            irReceiver.textContent = 'IR Receiver: מחכה לאות...';
            irReceiver.style.background = '#1a1a1a';
            irReceiver.style.color = '#00ff00';
        }

        function finishLearning() {
            learningInProgress = false;
            acState.learned = true;
            
            // הסתרת פאנל הלמידה והצגת מידע המכשיר
            document.getElementById('learningPanel').style.display = 'none';
            document.getElementById('deviceInfo').style.display = 'block';
            
            // זיהוי אוטומטי של המותג והדגם
            autoDetectModel();
            
            // הפעלת הכפתורים
            enableControls();
            
            showNotification('🎉 הלמידה הושלמה בהצלחה!', 'success');
        }

        async function waitForIRSignal() {
            return new Promise(resolve => {
                // סימולציה של זמן המתנה לאות
                const waitTime = Math.random() * 3000 + 2000; // 2-5 שניות
                setTimeout(resolve, waitTime);
            });
        }

        function generateRandomIRCode() {
            // יצירת קוד IR אקראי לדוגמא
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
            let result = 'JgB';
            for (let i = 0; i < 80; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function getCommandDescription(command) {
            const descriptions = {
                power: 'לחץ על כפתור ההפעלה',
                cool_22: 'קירור 22 מעלות',
                heat_22: 'חימום 22 מעלות',
                cool_18: 'קירור 18 מעלות',
                heat_18: 'חימום 18 מעלות',
                fan: 'מאוורר בלבד',
                dry: 'מצב יבוש'
            };
            return descriptions[command] || command;
        }

        // זיהוי אוטומטי של הדגם
        function autoDetectModel() {
            // ניתוח הקודים שנלמדו לזיהוי המותג והדגם
            const detectedBrand = 'electra'; // סימולציה
            const detectedModel = 'Elite Pro 18 (ELT-18H)'; // סימולציה
            
            acState.brand = detectedBrand;
            acState.model = detectedModel;
            
            // עדכון התצוגה
            document.getElementById('detectedModel').textContent = `${brandInfo[detectedBrand].name} ${detectedModel}`;
            document.getElementById('brandTitle').textContent = brandInfo[detectedBrand].name;
            document.getElementById('brandDescription').textContent = `דגם זוהה: ${detectedModel}`;
            
            // עדכון הבוחרים
            document.getElementById('brandSelect').value = detectedBrand;
            updateModelSelector();
            document.getElementById('modelSelect').value = detectedModel;
        }

        // עדכון רשימת הדגמים לפי המותג
        function updateModelSelector() {
            const brandSelect = document.getElementById('brandSelect');
            const modelSelect = document.getElementById('modelSelect');
            const selectedBrand = brandSelect.value;
            
            modelSelect.innerHTML = '<option value="">בחר דגם...</option>';
            
            if (selectedBrand && brandModels[selectedBrand]) {
                brandModels[selectedBrand].forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelSelect.appendChild(option);
                });
                modelSelect.style.display = 'block';
            } else {
                modelSelect.style.display = 'none';
            }
        }

        // הפעלת הכפתורים לאחר זיהוי המזגן
        function enableControls() {
            const buttons = document.querySelectorAll('button[disabled]');
            buttons.forEach(btn => btn.disabled = false);
            
            updateDisplay();
        }

        // עדכון תצוגה
        function updateDisplay() {
            const tempDisplay = document.getElementById('tempDisplay');
            const modeDisplay = document.getElementById('modeDisplay');
            const detailsDisplay = document.getElementById('detailsDisplay');
            const powerIndicator = document.getElementById('powerIndicator');
            const powerButton = document.getElementById('powerButton');
            
            if (!acState.brand) {
                tempDisplay.textContent = '--°';
                modeDisplay.textContent = 'בחר מזגן תחילה';
                detailsDisplay.textContent = 'השתמש באשף הגילוי למעלה';
                return;
            }
            
            if (!acState.power) {
                tempDisplay.textContent = `${acState.temperature}°`;
                modeDisplay.textContent = 'מזגן כבוי';
                detailsDisplay.textContent = 'לחץ על כפתור ההפעלה';
                powerIndicator.classList.remove('on');
                powerButton.classList.remove('active');
            } else {
                tempDisplay.textContent = `${acState.temperature}°`;
                
                const modeTexts = {
                    cool: 'מצב קירור',
                    heat: 'מצב חימום',
                    dry: 'מצב יבוש',
                    fan: 'מצב מאוורר'
                };
                
                modeDisplay.textContent = modeTexts[acState.mode];
                detailsDisplay.textContent = `מאוורר: ${acState.fanSpeed} • דגם: ${acState.model}`;
                powerIndicator.classList.add('on');
                powerButton.classList.add('active');
            }
            
            document.getElementById('tempMiniDisplay').textContent = `${acState.temperature}°`;
            
            // עדכון כפתורי מצב
            document.querySelectorAll('[data-mode]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === acState.mode && acState.power);
            });
        }

        // שליחת פקודה עם הקודים שנלמדו
        async function sendLearnedCommand(command) {
            if (!acState.learned) {
                showNotification('❌ יש ללמוד את הקודים תחילה', 'error');
                return false;
            }
            
            const code = acState.learnedCodes[command];
            if (!code) {
                showNotification(`❌ הקוד ${command} לא נלמד`, 'error');
                return false;
            }
            
            console.log(`📡 שולח קוד נלמד: ${command} = ${code}`);
            showNotification(`✅ פקודה נשלחה: ${command}`, 'success');
            return true;
        }

        // פונקציות בקרה
        async function togglePower() {
            acState.power = !acState.power;
            updateDisplay();
            await sendLearnedCommand('power');
        }

        async function adjustTemp(delta) {
            if (!acState.power) {
                showNotification('הפעל את המזגן תחילה', 'error');
                return;
            }
            
            const newTemp = acState.temperature + delta;
            if (newTemp < 16 || newTemp > 30) {
                showNotification('טמפרטורה חייבת להיות בין 16-30 מעלות', 'error');
                return;
            }
            
            acState.temperature = newTemp;
            updateDisplay();
            
            const command = `${acState.mode}_${acState.temperature}`;
            await sendLearnedCommand(command);
        }

        async function setMode(mode) {
            if (!acState.power) {
                showNotification('הפעל את המזגן תחילה', 'error');
                return;
            }
            
            acState.mode = mode;
            updateDisplay();
            
            const command = `${mode}_${acState.temperature}`;
            await sendLearnedCommand(command);
        }

        // הצגת הודעות
        function showNotification(message, type = 'success') {
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(-50%) translateY(-100%)';
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // מאזיני אירועים
        document.getElementById('brandSelect').addEventListener('change', function(e) {
            if (e.target.value) {
                acState.brand = e.target.value;
                updateModelSelector();
                
                const brand = brandInfo[acState.brand];
                document.getElementById('brandTitle').textContent = brand.name;
                document.getElementById('brandDescription').textContent = brand.info;
                
                updateDisplay();
            }
        });

        document.getElementById('modelSelect').addEventListener('change', function(e) {
            if (e.target.value) {
                acState.model = e.target.value;
                acState.learned = true; // אם בחר ידנית, נניח שהקודים זמינים
                enableControls();
                
                document.getElementById('brandDescription').textContent = `דגם נבחר: ${acState.model}`;
                showNotification(`✅ דגם נבחר: ${acState.model}`, 'success');
            }
        });

        // אתחול
        updateDisplay();
        
        console.log('🚀 שלט מזגן חכם עם זיהוי דגמים הופעל!');
        console.log('📋 דגמים זמינים:', Object.keys(brandModels).length, 'מותגים');
    </script>
</body>
</html>